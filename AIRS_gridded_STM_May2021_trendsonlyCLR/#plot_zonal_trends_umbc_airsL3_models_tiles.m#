%% see plot_driver_gather_gridded_retrieval_results.m

WV_Ylim = 100;
T_Ylim  = 10;

disp('Enter (-7) polar    L/O')
disp('      (-6) midlat   L/O')
disp('      (-5) tropical L/O')
disp('      (-4) polar land    (+4) polar ocean')
disp('      (-3) midlat land   (+3) midlat ocean')
disp('      (-2) tropical land (+2) tropical ocean')
disp('      (-1) land          (+1) ocean');
disp('      [0,default] ALL trends : ');
ixAorOorL = input('Enter region : ');
if length(ixAorOorL) == 0 
  ixAorOorL = 0;
end

clear xmaskLF
xmaskLF = zeros(1,4608);
if ixAorOorL == -7
  xmaskLF(abs(Ylat) > 60) = 1;
  xstrmaskLF = '_polar_';
elseif ixAorOorL == -6
  xmaskLF(abs(Ylat) > 30 & abs(Ylat) <= 60) = 1;
  xstrmaskLF = '_midlat_';
elseif ixAorOorL == -5
  xmaskLF(abs(Ylat) < 30) = 1;
  xstrmaskLF = '_tropical_';
elseif ixAorOorL == 0
  xmaskLF = ones(1,4608);
  xstrmaskLF = '_all_';
elseif ixAorOorL == -1
  xmaskLF(landfrac == 1) = 1;
  xstrmaskLF = '_land_';
elseif ixAorOorL == +1
  xmaskLF(landfrac == 0) = 1;
  xstrmaskLF = '_ocean_';
elseif ixAorOorL == -2
  xmaskLF(landfrac == 1 & abs(Ylat) <= 30) = 1;
  xstrmaskLF = '_tropical_land_';  
elseif ixAorOorL == +2
  xmaskLF(landfrac == 0 & abs(Ylat) <= 30) = 1;
  xstrmaskLF = '_tropical_ocean_';  
elseif ixAorOorL == -3
  xmaskLF(landfrac == 1 & abs(Ylat) > 30 & abs(Ylat) <= 60) = 1;
  xstrmaskLF = '_midlat_land_';  
elseif ixAorOorL == +3
  xmaskLF(landfrac == 0 & abs(Ylat) > 30 & abs(Ylat) <= 60) = 1;
  xstrmaskLF = '_midlat_ocean_';  
elseif ixAorOorL == -4
  xmaskLF(landfrac == 1 & abs(Ylat) > 60) = 1;
  xstrmaskLF = '_polar_land_';  
elseif ixAorOorL == +4
  xmaskLF(landfrac == 0 & abs(Ylat) > 60) = 1;
  xstrmaskLF = '_polar_ocean_';  
end

if iNorD == 1
  xstrmaskLF = [xstrmaskLF 'N_'];
else
  xstrmaskLF = [xstrmaskLF 'D_'];
end

xmaskLFmatr = reshape(xmaskLF,72,64)';
xmask = find(xmaskLF == 1);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% see find_T_RH_trends.m

plot_zonal_trends_umbc_airsL3_models_tiles.m
junk = deltaT .* (ones(101,1) * xmaskLF);
for ii = 1 : length(rlat)
  boo = find(abs(p.rlat - rlat(ii)) < 0.5); findlat(ii) = length(boo);
  xdeltaTlat(ii,:) = nanmean(junk(:,boo),2);
end
figure(28); clf
pcolor(rlat,pavgLAY(1:97,3000),xdeltaTlat(:,1:97)'); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(xdeltaTlat(:,1:97)',1)); 
shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log')
junk = zeros(size(xdeltaTlat)); junk = cos(rlat) * ones(1,101);
%area_wgtT = nansum(xdeltaTlat.*junk,1)./nansum(junk,1);
%hold on; plot(area_wgtT(1:97)*1000,pavgLAY(1:97,1000),'color','r','linewidth',2); hold off
ylim([T_Ylim 1000]); caxis([-0.15 +0.15]); colorbar('horizontal'); colormap(cmap); title(['Zonal d/dt T UMBC Quantile' num2str(iQuantile,'%02d')]) %plotaxis2;
%% aslprint('/home/sergio/PAPERS/AIRS/AIRS-STM-May-2021/tiletrends/Figs/umbc_T_zonal_trends.pdf');

junk = deltaRH .* (ones(100,1) * xmaskLF);
for ii = 1 : length(rlat)
  boo = find(abs(p.rlat - rlat(ii)) < 0.5); findlat(ii) = length(boo);
  xdeltaRHlat(ii,:) = nanmean(junk(:,boo),2);
end
figure(29);
pcolor(rlat,pavgLAY(1:97,3000),xdeltaRHlat(:,1:97)'); shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log')
junk = zeros(size(xdeltaRHlat)); junk = cos(rlat) * ones(1,100);
area_wgtRH = nansum(xdeltaRHlat.*junk,1)./nansum(junk,1);
%hold on; plot(area_wgtRH(1:97)*100,pavgLAY(1:97,1000),'color','r','linewidth',2); hold off
ylim([WV_Ylim 1000]); caxis([-0.15 +0.15]); colorbar('horizontal'); colormap(cmap); title(['Zonal d/dt RH UMBC Quantile' num2str(iQuantile,'%02d')]) %plotaxis2;
%% aslprint('/home/sergio/PAPERS/AIRS/AIRS-STM-May-2021/tiletrends/Figs/umbc_rh_zonal_trends.pdf');

junk = fracWV .* (ones(101,1) * xmaskLF);
for ii = 1 : length(rlat)
  boo = find(abs(p.rlat - rlat(ii)) < 0.5); findlat(ii) = length(boo);
  xfracWVlat(ii,:) = nanmean(junk(:,boo),2);
end
figure(30); 
pcolor(rlat,pavgLAY(1:97,1000),xfracWVlat(:,1:97)'); shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log')
junk = zeros(size(xfracWVlat)); junk = cos(rlat) * ones(1,101);
area_wgt_xfracWV = nansum(xfracWVlat.*junk,1)./nansum(junk,1);
%hold on; plot(area_wgt_xfracWV(1:97)*10000,pavgLAY(1:97,1000),'color','r','linewidth',2); hold off
ylim([WV_Ylim 1000]); caxis([-2 +2]*1e-3); colorbar('horizontal'); %plotaxis2;
title(['Zonal d/dt WVfrac UMBC Quantile' num2str(iQuantile,'%02d')]) %plotaxis2;
colormap(cmap)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

iFig = 45;

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era.trend_ptemp,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([T_Ylim 1000]); title([strNorD ' dT/dt ERA K/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era5.trend_ptemp,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([T_Ylim 1000]); title([strNorD ' dT/dt ERA5 K/yr']);

boo = zeros(72,64,24); for ijunk = 1 : 24; boo(:,:,ijunk) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.* airsL3.thestats64x72.ptemprate; junk = squeeze(nanmean(junk,1))'; pcolor(rlat,airsL3.Tlevs,smoothn(junk(1:24,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([T_Ylim 1000]); title([strNorD ' dT/dt AIRS L3 K/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.* reshape(cmip6.trend_ptemp,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([T_Ylim 1000]); title(['D/N dT/dt CMIP6  K/yr']);

%%%%%%%%%%%%%%%%%%%%%%%%%

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era.trend_RH,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([WV_Ylim 1000]); title([strNorD ' dRH/dt ERA percent/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era5.trend_RH,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([WV_Ylim 1000]); title([strNorD ' dRH/dt ERA5 percent/yr']);

boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.* airsL3.thestats64x72.RHrate; junk = squeeze(nanmean(junk,1))'; pcolor(rlat,airsL3.Qlevs,smoothn(junk(1:12,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([WV_Ylim 1000]); title([strNorD ' dRH/dt AIRS L3 percent/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(cmip6.trend_RH,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.15); ylim([WV_Ylim 1000]); title(['D/N dRH/dt CMIP6 percent/yr']);

%%%%%%%%%%%%%%%%%%%%%%%%%

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era.trend_gas_1,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.01); ylim([WV_Ylim 1000]); title([strNorD ' d(fracWV)/dt ERA 1/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(era5.trend_gas_1,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.01); ylim([WV_Ylim 1000]); title([strNorD ' d(fracWV)/dt ERA5 1/yr']);

boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.* airsL3.thestats64x72.waterrate; junk = squeeze(nanmean(junk,1))'; pcolor(rlat,airsL3.Qlevs,smoothn(junk(1:12,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.01); ylim([WV_Ylim 1000]); title([strNorD ' d(fracWV)/dt AIRS L3 1/yr']);

boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
iFig = iFig + 1; figure(iFig); clf;  junk = boo.*reshape(cmip6.trend_gas_1,100,72,64); junk = squeeze(nanmean(junk,2)); pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); colorbar('southoutside'); colormap(llsmap5)
 shading interp; set(gca,'ydir','reverse'); set(gca,'yscale','log'); caxis([-1 +1]*0.01); ylim([WV_Ylim 1000]); title(['D/N d(fracWV)/dt CMIP6 1/yr']);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure(32)
ta = tiledlayout(2,2);
ta.OuterPosition = [0.0375 0.0375 0.925 0.925];

cmap = llsmap5;
cmax = 0.15;

tafov(1) = nexttile;
pcolor(rlat,pavgLAY(1:97,3000),smoothn(xdeltaTlat(:,1:97)',1)); %title('UMBC','Fontsize',12);
shading interp;

tafov(2) = nexttile;
boo = zeros(72,64,24); for ijunk = 1 : 24; boo(:,:,ijunk) = xmaskLFmatr'; end
junk = boo.* airsL3.thestats64x72.ptemprate; 
junk = squeeze(nanmean(junk,1))'; 
pcolor(rlat,airsL3.Tlevs,smoothn(junk(1:24,:),1)); %title('AIRSL3','Fontsize',12);
shading interp;

tafov(3) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.*reshape(era5.trend_ptemp,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); %title('ERA5','Fontsize',12); 
shading interp;

tafov(4) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.* reshape(cmip6.trend_ptemp,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1));  %title('MERRA','Fontsize',12); 
shading interp;

tafov(1).FontSize = 10;
tafov(2).FontSize = 10;
tafov(3).FontSize = 10;
tafov(4).FontSize = 10;

set(tafov,'ydir','reverse');   
set(tafov,'yscale','log');  
set(tafov,'colormap',cmap,'CLim',[-cmax +cmax]);
set(tafov,'Ylim',[T_Ylim 1000]);
%set(tafov,'shading','interp');

% Get rid of all extra space I can
ta.Padding = 'none';
ta.TileSpacing = 'none';
ta.TileSpacing = 'compact';

% Remove all ytick labels except for 1st column
for ii = [2 4]
   tafov(ii).YTickLabel = '';
end
% Remove all xtick labels except for 2nd row
for ii = [1 2]
   tafov(ii).XTickLabel = '';
end

% Put in xlabel and ylable in the “middle”
tafov(1).YLabel.String = 'P(mb)'; tafov(1).YLabel.FontSize = 10;
tafov(3).YLabel.String = 'P(mb)'; tafov(3).YLabel.FontSize = 10;
tafov(3).XLabel.String = 'Latitude'; tafov(3).XLabel.FontSize = 10;
tafov(4).XLabel.String = 'Latitude'; tafov(4).XLabel.FontSize = 10;
%xlabel(tafov(2),'Latitude','fontsize',10)
%ylabel(tafov(1),'P(mb)','fontsize',10)

%% put titles
title(tafov(1),'UMBC', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(2),'AIRS L3', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(3),'ERA5', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(4),'CMIP6', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);

%% assign colorbar to one tile
cbh = colorbar(tafov(3));
cbh.Layout.Tile = 'south';

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure(33)
ta = tiledlayout(2,2);
ta.OuterPosition = [0.0375 0.0375 0.925 0.925];

cmap = llsmap5;
cmax = 0.01;

tafov(1) = nexttile;
pcolor(rlat,pavgLAY(1:97,3000),smoothn(xfracWVlat(:,1:97)',1)); %title('UMBC','Fontsize',12);
shading interp;

tafov(2) = nexttile;
boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
junk = boo.* airsL3.thestats64x72.waterrate; 
junk = squeeze(nanmean(junk,1))'; 
pcolor(rlat,airsL3.Qlevs,smoothn(junk(1:12,:),1)); %title('AIRSL3','Fontsize',12);
shading interp;

tafov(3) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.*reshape(era5.trend_gas_1,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); %title('ERA5','Fontsize',12); 
shading interp;

tafov(4) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.* reshape(cmip6.trend_gas_1,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1));  %title('MERRA','Fontsize',12); 
shading interp;

tafov(1).FontSize = 10;
tafov(2).FontSize = 10;
tafov(3).FontSize = 10;
tafov(4).FontSize = 10;

set(tafov,'ydir','reverse');   
set(tafov,'yscale','log');  
set(tafov,'colormap',cmap,'CLim',[-cmax +cmax]);
set(tafov,'Ylim',[WV_Ylim 1000]);
%set(tafov,'shading','interp');

% Get rid of all extra space I can
ta.Padding = 'none';
ta.TileSpacing = 'none';
ta.TileSpacing = 'compact';

% Remove all ytick labels except for 1st column
for ii = [2 4]
   tafov(ii).YTickLabel = '';
end
% Remove all xtick labels except for 2nd row
for ii = [1 2]
   tafov(ii).XTickLabel = '';
end

% Put in xlabel and ylable in the “middle”
tafov(1).YLabel.String = 'P(mb)'; tafov(1).YLabel.FontSize = 10;
tafov(3).YLabel.String = 'P(mb)'; tafov(3).YLabel.FontSize = 10;
tafov(3).XLabel.String = 'Latitude'; tafov(3).XLabel.FontSize = 10;
tafov(4).XLabel.String = 'Latitude'; tafov(4).XLabel.FontSize = 10;
%xlabel(tafov(2),'Latitude','fontsize',10)
%ylabel(tafov(1),'P(mb)','fontsize',10)

%% put titles
title(tafov(1),'UMBC', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(2),'AIRS L3', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(3),'ERA5', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(4),'CMIP6', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);

%% assign colorbar to one tile
cbh = colorbar(tafov(3));
cbh.Layout.Tile = 'south';

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

figure(34)
ta = tiledlayout(2,2);
ta.OuterPosition = [0.0375 0.0375 0.925 0.925];

cmap = llsmap5;
cmax = 0.15;

tafov(1) = nexttile;
pcolor(rlat,pavgLAY(1:97,3000),smoothn(xdeltaRHlat(:,1:97)',1)); %title('UMBC','Fontsize',12);
shading interp;

tafov(2) = nexttile;
boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
junk = boo.* airsL3.thestats64x72.RHrate; 
junk = squeeze(nanmean(junk,1))'; 
pcolor(rlat,airsL3.Qlevs,smoothn(junk(1:12,:),1)); %title('AIRSL3','Fontsize',12);
shading interp;

tafov(3) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.*reshape(era5.trend_RH,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1)); %title('ERA5','Fontsize',12); 
shading interp;

tafov(4) = nexttile;
boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end
junk = boo.* reshape(cmip6.trend_RH,100,72,64); 
junk = squeeze(nanmean(junk,2)); 
pcolor(rlat,pavgLAY(1:97,3000),smoothn(junk(1:97,:),1));  %title('MERRA','Fontsize',12); 
shading interp;

tafov(1).FontSize = 10;
tafov(2).FontSize = 10;
tafov(3).FontSize = 10;
tafov(4).FontSize = 10;

set(tafov,'ydir','reverse');   
set(tafov,'yscale','log');  
set(tafov,'colormap',cmap,'CLim',[-cmax +cmax]);
set(tafov,'Ylim',[WV_Ylim 1000]);
%set(tafov,'shading','interp');

% Get rid of all extra space I can
ta.Padding = 'none';
ta.TileSpacing = 'none';
ta.TileSpacing = 'compact';

% Remove all ytick labels except for 1st column
for ii = [2 4]
   tafov(ii).YTickLabel = '';
end
% Remove all xtick labels except for 2nd row
for ii = [1 2]
   tafov(ii).XTickLabel = '';
end

% Put in xlabel and ylable in the “middle”
tafov(1).YLabel.String = 'P(mb)'; tafov(1).YLabel.FontSize = 10;
tafov(3).YLabel.String = 'P(mb)'; tafov(3).YLabel.FontSize = 10;
tafov(3).XLabel.String = 'Latitude'; tafov(3).XLabel.FontSize = 10;
tafov(4).XLabel.String = 'Latitude'; tafov(4).XLabel.FontSize = 10;
%xlabel(tafov(2),'Latitude','fontsize',10)
%ylabel(tafov(1),'P(mb)','fontsize',10)

%% put titles
title(tafov(1),'UMBC', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(2),'AIRS L3', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(3),'ERA5', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);
title(tafov(4),'CMIP6', 'Units', 'normalized', 'Position', [0.5, +0.9, 0]);

%% assign colorbar to one tile
cbh = colorbar(tafov(3));
cbh.Layout.Tile = 'south';

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% see plot_profile_trends2.m
coswgt101 = ones(101,1) * cos(p.rlat*pi/180);
coswgt100 = ones(100,1) * cos(p.rlat*pi/180);
coswgt097 = ones(097,1) * cos(p.rlat*pi/180);
coswgt012 = ones(012,1) * cos(p.rlat*pi/180);
coswgt024 = ones(024,1) * cos(p.rlat*pi/180);
iFig = 34;
iFig = iFig + 1; figure(iFig); clf;  subplot(121); semilogy(nanmean(coswgt100(:,xmask).*fracWV(1:100,xmask),2),plays,'linewidth',2);         ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\mu} frac pert');
                                     subplot(122); semilogy(1+nanstd(coswgt100(:,xmask).*fracWV(1:100,xmask),[],2),plays,'linewidth',2);     ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\sigma} frac pert');
iFig = iFig + 1; figure(iFig); clf;  subplot(121); semilogy(nanmean(coswgt100(:,xmask).*deltaRH(1:100,xmask),2),plays,'linewidth',2);        ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\mu} pert (%)');
                                     subplot(122); semilogy(nanstd(coswgt100(:,xmask).*deltaRH(1:100,xmask),[],2),plays,'linewidth',2);      ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\sigma} pert (%)');
iFig = iFig + 1; figure(iFig); clf;  subplot(121); semilogy(nanmean(coswgt100(:,xmask).*deltaT(1:100,xmask),2),plays,'linewidth',2);         ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\mu} pert');
                                     subplot(122); semilogy(nanstd(coswgt100(:,xmask).*deltaT(1:100,xmask),[],2),plays,'linewidth',2);       ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\sigma} pert');
iFig = iFig + 1; figure(iFig); clf;  subplot(121); semilogy(nanmean(coswgt097(:,xmask).*deltaO3(1:97,xmask),2),plays(1:97),'linewidth',2);   ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\mu} ppm pert');
                                     subplot(122); semilogy(nanstd(coswgt097(:,xmask).*deltaO3(1:97,xmask),[],2),plays(1:97),'linewidth',2); ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\sigma} ppm pert');

if exist('airsL3')
  iFig = 34;
  Tlevs = airsL3.Tlevs;
  Qlevs = airsL3.Qlevs;

  boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
  junk = airsL3.thestats64x72.waterrate.*boo; junk = reshape(junk,72*64,12);  
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt012(:,xmask)'.*junk(xmask,:),1)',Qlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\mu} frac pert');
                                   subplot(122); hold on; semilogy(1+nanstd(coswgt012(:,xmask)'.*junk(xmask,:),[],1)',Qlevs,'linewidth',2);     hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\sigma} frac pert');

  boo = zeros(72,64,12); for ijunk = 1 : 12; boo(:,:,ijunk) = xmaskLFmatr'; end
  junk = airsL3.thestats64x72.RHrate.*boo; junk = reshape(junk,72*64,12);  
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt012(:,xmask)'.*junk(xmask,:),1)',Qlevs,'linewidth',2);        hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\mu} pert (%)');
                                   subplot(122); hold on; semilogy(nanstd(coswgt012(:,xmask)'.*junk(xmask,:),[],1)',Qlevs,'linewidth',2);      hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\sigma} pert (%)');

  boo = zeros(72,64,12); for ijunk = 1 : 24; boo(:,:,ijunk) = xmaskLFmatr'; end
  junk = airsL3.thestats64x72.ptemprate.*boo; junk = reshape(junk,72*64,24);  
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt024(:,xmask)'.*junk(xmask,:),1)',Tlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\mu} pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt024(:,xmask)'.*junk(xmask,:),[],1)',Tlevs,'linewidth',2);       hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\sigma} pert');

  boo = zeros(72,64,12); for ijunk = 1 : 24; boo(:,:,ijunk) = xmaskLFmatr'; end
  junk = airsL3.thestats64x72.ozonerate.*boo; junk = reshape(junk,72*64,24);  
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt024(:,xmask)'.*junk(xmask,:),1)',Tlevs,'linewidth',2);   hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\mu} ppm pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt024(:,xmask)'.*junk(xmask,:),[],1)',Tlevs,'linewidth',2); hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\sigma} ppm pert');
end

if exist('cmip6')
  iFig = 34;
  Tlevs = plays;
  Qlevs = plays;
  boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end

  junk = cmip6.trend_gas_1; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Qlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\mu} frac pert');
                                   subplot(122); hold on; semilogy(1+nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Qlevs,'linewidth',2);     hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\sigma} frac pert');

  junk = cmip6.trend_RH; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Qlevs,'linewidth',2);        hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\mu} pert (%)');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Qlevs,'linewidth',2);      hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\sigma} pert (%)');

  junk = cmip6.trend_ptemp; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Tlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\mu} pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Tlevs,'linewidth',2);       hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\sigma} pert');

  junk = cmip6.trend_gas_3; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Tlevs,'linewidth',2);   hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\mu} ppm pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Tlevs,'linewidth',2); hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\sigma} ppm pert');
end

if exist('era5')
  iFig = 34;
  Tlevs = plays;
  Qlevs = plays;
  boo = zeros(100,72,64); for ijunk = 1 : 100; boo(ijunk,:,:) = xmaskLFmatr'; end

  junk = era5.trend_gas_1; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Qlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\mu} frac pert');
                                   subplot(122); hold on; semilogy(1+nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Qlevs,'linewidth',2);     hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('WV_{\sigma} frac pert');

  junk = era5.trend_RH; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Qlevs,'linewidth',2);        hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\mu} pert (%)');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Qlevs,'linewidth',2);      hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('RH_{\sigma} pert (%)');

  junk = era5.trend_ptemp; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Tlevs,'linewidth',2);         hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\mu} pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Tlevs,'linewidth',2);       hold off; ylim([1 1000]); set(gca,'ydir','reverse'); title('T_{\sigma} pert');

  junk = era5.trend_gas_3; junk = reshape(junk,100,72,64); junk = junk.*boo; junk = reshape(junk,100,72*64);
  iFig = iFig + 1; figure(iFig);   subplot(121); hold on; semilogy(nanmean(coswgt100(:,xmask).*junk(:,xmask),2)',Tlevs,'linewidth',2);   hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\mu} ppm pert');
                                   subplot(122); hold on; semilogy(nanstd(coswgt100(:,xmask).*junk(:,xmask),[],2)',Tlevs,'linewidth',2); hold off; ylim([0.01 1000]); set(gca,'ydir','reverse'); title('O3_{\sigma} ppm pert');
end

iFig = 34;
iFig = iFig+1; figure(iFig); subplot(121); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([-1 +1]*1e-2)
                             subplot(122); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([0 0.01]/2+1)
iFig = iFig+1; figure(iFig); subplot(121); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([-1 +1]*0.25)
                             subplot(122); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([0 1]/2)
iFig = iFig+1; figure(iFig); subplot(121); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([-1 +1]*0.035) 
                             subplot(122); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([0 1]*0.05)
iFig = iFig+1; figure(iFig); subplot(121); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([-1 +1]*0.01/2)
                             subplot(122); hold on; plotaxis2; hl = legend('UMBC','AIRSL3','CMIP6','ERA5','location','best','fontsize',8); hold off; xlim([0 1]*0.01/2)

%%%%%%%%%%%%%%%%%%%%%%%%%
iFig = iFig + 1;
figure(iFig); clf
  plot(f,nanmean(rates(:,xmask),2),'k',f,nanmean(fits(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.airsL3_spectral_rates(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.cmip6_spectral_rates(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.era5_spectral_rates(:,xmask),2),'linewidth',2)
  plot(f,nanmean(rates(:,xmask),2),'k',f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.umbc_spectral_rates(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.airsL3_spectral_rates(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.cmip6_spectral_rates(:,xmask),2),...
                                      f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.era5_spectral_rates(:,xmask),2),'linewidth',2)
  plotaxis2; hl = legend('AIRS Obs','UMBC','AIRS L3','CMIP6','ERA5','location','best'); axis([640 1640 -0.1 0.05]); title('Spectral Rates');

  plot(f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.umbc_spectral_rates(:,xmask),2),'x-',...
       f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.airsL3_spectral_rates(:,xmask),2),...
       f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.cmip6_spectral_rates(:,xmask),2),...
       f,nanmean(nwp_spectral_trends_cmip6_era5_airsL3_umbc.era5_spectral_rates(:,xmask),2),f,nanmean(rates(:,xmask),2),'linewidth',2)
  plotaxis2; hl = legend('UMBC','AIRS L3','CMIP6','ERA5','AIRS Obs','location','best','fontsize',8); axis([640 1640 -0.1 0.05]); title('Spectral Rates');

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

iPrint = input('print the figs +1/-1   (default = -1) : ');
if length(iPrint) == 0
  iPrint = -1;
end
addpath /asl/matlib/plotutils
if iPrint > 0
  printdir = 'Figs_STMOct2021/';

%{
  figure(28); figname = [printdir '/umbc' xstrmaskLF 'T_trend.pdf'];      aslprint(figname)
  figure(29); figname = [printdir '/umbc' xstrmaskLF 'RH_trend.pdf'];     aslprint(figname)
  figure(30); figname = [printdir '/umbc' xstrmaskLF 'WVfrac_trend.pdf']; aslprint(figname)

  figure(46); figname = [printdir '/era' xstrmaskLF 'T_trend.pdf'];    aslprint(figname)
  figure(47); figname = [printdir '/era5' xstrmaskLF 'T_trend.pdf'];   aslprint(figname)
  figure(48); figname = [printdir '/airsL3' xstrmaskLF 'T_trend.pdf']; aslprint(figname)
  figure(49); figname = [printdir '/cmip6' xstrmaskLF 'T_trend.pdf'];  aslprint(figname)

  figure(50); figname = [printdir '/era' xstrmaskLF 'RH_trend.pdf'];    aslprint(figname)
  figure(51); figname = [printdir '/era5' xstrmaskLF 'RH_trend.pdf'];   aslprint(figname)
  figure(52); figname = [printdir '/airsL3' xstrmaskLF 'RH_trend.pdf']; aslprint(figname)
  figure(53); figname = [printdir '/cmip6' xstrmaskLF 'RH_trend.pdf'];  aslprint(figname)

  figure(54); figname = [printdir '/era' xstrmaskLF 'WVfrac_trend.pdf'];    aslprint(figname)
  figure(55); figname = [printdir '/era5' xstrmaskLF 'WVfrac_trend.pdf'];   aslprint(figname)
  figure(56); figname = [printdir '/airsL3' xstrmaskLF 'WVfrac_trend.pdf']; aslprint(figname)
  figure(57); figname = [printdir '/cmip6' xstrmaskLF 'WVfrac_trend.pdf'];  aslprint(figname)
%}

  figure(32); figname = [printdir '/tiled' xstrmaskLF 'T_trend.pdf'];      aslprint(figname)
  figure(33); figname = [printdir '/tiled' xstrmaskLF 'RH_trend.pdf'];     aslprint(figname)
  figure(34); figname = [printdir '/tiled' xstrmaskLF 'WVfrac_trend.pdf']; aslprint(figname)
  figure(35); figname = [printdir '/spectral' xstrmaskLF 'rates.pdf'];     aslprint(figname)

end


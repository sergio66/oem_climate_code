% Two versions of covariance;
% "prof" to optimize profiles, "carb" to optimize gases
covariance_tuning='prof'

% Build up covariance matrices
if covariance_tuning=='prof'

% index lat     TS      TUT      TLT      WVS      WVT      CO2
   cov_prof1 = [  
      1    -62    1.00     1.00     1.00     0.25     0.08     5.00  ; ...
      2    -53    1.00     1.00     1.00     0.25     0.08     5.00  ; ...
      3    -47    1.00     1.00     1.00     0.25     0.14     5.00  ; ...
      4    -42    1.00     1.00     0.50     0.25     0.14     5.00  ; ...
      5    -37    1.00     1.00     0.60     0.25     0.14     5.00  ; ...
      6    -32    1.00     0.70     0.50     0.25     0.14     5.00  ; ...
      7    -28    1.00     1.00     0.50     0.30     0.14     5.00  ; ...
      8    -26    1.00     1.00     0.50     0.30     0.14     5.00  ; ...
      9    -23    1.00     1.00     0.40     0.30     0.20     5.00  ; ...
      10   -21    1.00     0.90     0.40     0.30     0.10     5.00  ; ...
      11   -18    1.00     0.40     0.40     0.30     0.10     5.00  ; ...
      12   -16    1.00     0.90     0.40     0.30     0.10     5.00  ; ...
      13   -13    1.00     0.90     0.40     0.30     0.10     5.00  ; ...
      14   -11    1.00     0.90     0.40     0.30     0.10     5.00  ; ...
      15    -8    1.00     1.00     0.60     0.30     0.10     5.00  ; ...
      16    -6    1.00     0.90     0.65     0.30     0.08     5.00  ; ...
      17    -3    1.00     0.90     0.65     0.30     0.08     5.00  ; ...
      18    -1    1.00     0.90     0.65     0.30     0.10     5.00  ; ...
      19     1    0.50     0.20     0.30     0.30     0.10     5.00  ; ...
      20     3    0.50     0.50     0.20     0.30     0.18     5.00  ; ...
      21     6    0.50     0.50     0.10     0.30     0.18     5.00  ; ...
      22     8    0.50     0.50     0.10     0.30     0.18     5.00  ; ...
      23    11    0.50     0.50     0.20     0.20     0.10     5.00  ; ...
      24    13    0.50     0.50     0.20     0.15     0.10     5.00  ; ...
      25    16    0.50     0.50     0.12     0.30     0.15     5.00  ; ...
      26    18    0.50     0.80     0.20     0.40     0.20     5.00  ; ...
      27    21    0.50     0.40     0.20     0.50     0.30     5.00  ; ...
      28    23    0.50     0.50     0.30     0.50     0.30     5.00  ; ...
      29    26    0.80     0.80     0.30     0.50     0.20     5.00  ; ...
      30    28    1.00     0.80     0.30     0.50     0.20     5.00  ; ...
      31    32    1.00     0.80     0.30     0.50     0.10     5.00  ; ...
      32    37    1.00     0.80     0.30     0.50     0.20     5.00  ; ...
      33    42    0.70     1.00     0.50     0.40     0.20     5.00  ; ...
      34    47    1.00     1.00     1.00     0.50     0.50     5.00  ; ...
      35    55    1.00     1.00     1.50     0.50     0.30     5.00  ; ...
      36    63    1.00     1.00     1.00     0.50     0.30     5.00  ];

% index lat     O3       N2O      CH4     CFC11    STEMP    C_L
   cov_prof2 = [
      1    -62    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      2    -53    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      3    -47    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      4    -42    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      5    -37    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      6    -32    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      7    -28    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      8    -26    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      9    -23    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      10   -21    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      11   -18    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      12   -16    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      13   -13    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      14   -11    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      15    -8    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      16    -6    2.00     2.00     1.00     1.00     0.20     2.20  ; ...
      17    -3    2.00     2.00     1.00     1.00     3.00     2.20  ; ...
      18    -1    2.00     1.00     1.00     1.00     3.00     2.20  ; ...
      19     1    2.00     2.00     1.00     1.00     3.00     2.20  ; ...
      20     3    2.00     2.00     1.00     1.00     3.00     2.20  ; ...
      21     6    2.00     2.00     1.00     1.00     3.00     2.20  ; ...
      22     8    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      23    11    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      24    13    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      25    16    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      26    18    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      27    21    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      28    23    2.00     2.00     1.00     1.00     0.10     0.50  ; ...
      29    26    2.00     2.00     1.00     1.00     3.00     2.20  ; ...
      30    28    2.00     2.00     1.00     1.00     0.10     2.20  ; ...
      31    32    2.00     1.00     1.00     1.00     0.10     2.20  ; ...
      32    37    2.00     1.00     2.00     1.00     0.10     2.20  ; ...
      33    42    1.00     1.00     1.00     1.00     0.10     1.80  ; ...
      34    47    1.00     1.00     1.00     1.00     0.10     1.80  ; ...
      35    55    1.00     1.00     1.00     1.00     0.10     1.80  ; ...
      36    63    1.00     1.00     1.00     1.00     0.10     2.10  ];        
   
   cov_prof = [cov_prof1 cov_prof2(:,3:end)]; 
   clear cov_prof1 cov_prof2

% index lat TS TUT TLT WVS WVT CO2 O3 N2O CH4 CFC11 STEMP C_L
%   1    2   3  4   5   6   7   8   9  10  11   12    13   14
   TS    = cov_prof(:,3);
   TUT   = cov_prof(:,4);
   TLT   = cov_prof(:,5);
   WVS   = cov_prof(:,6);
   WVT   = cov_prof(:,7);
   CO2   = cov_prof(:,8);
   O3    = cov_prof(:,9); 
   N2O   = cov_prof(:,10);
   CH4   = cov_prof(:,11); 
   CFC11 = cov_prof(:,12); 
   STEMP = cov_prof(:,13); 
   C_L   = cov_prof(:,14);

else covariance_tuning=='carb'
    
% index lat     TS      TUT      TLT      WVS      WVT      CO2
   cov_carb1 = [
      1    -62    3.00     2.00     3.00     1.00     0.20     1.00  ; ...
      2    -53    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      3    -47    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      4    -42    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      5    -37    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      6    -32    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      7    -28    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      8    -26    3.00     2.00     3.00     1.00     0.20     1.00  ; ...
      9    -23    3.00     2.00     3.00     1.00     0.20     1.00  ; ...
      10   -21    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      11   -18    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      12   -16    3.00     2.00     3.00     1.00     0.37     1.00  ; ...
      13   -13    3.00     2.00     3.00     1.00     0.40     2.00  ; ...
      14   -11    3.00     2.00     3.00     1.00     0.40     1.00  ; ...
      15    -8    3.00     2.00     3.00     1.00     0.50     1.00  ; ...
      16    -6    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      17    -3    3.00     2.00     3.00     1.00     0.35     1.00  ; ...
      18    -1    3.00     2.00     3.00     1.00     0.25     1.00  ; ...
      19     1    3.00     2.00     3.00     1.00     0.25     1.00  ; ...
      20     3    3.00     2.00     3.00     1.00     0.20     1.00  ; ...
      21     6    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      22     8    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      23    11    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      24    13    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      25    16    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      26    18    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      27    21    3.00     2.00     3.00     1.00     0.30     1.00  ; ...
      28    23    3.00     3.00     3.00     1.00     0.30     2.00  ; ...
      29    26    3.20     2.00     3.00     1.00     0.30     1.00  ; ...
      30    28    2.00     2.00     3.00     2.00     1.00     1.00  ; ...
      31    32    2.00     2.00     3.00     1.00     1.00     1.00  ; ...
      32    37    2.00     2.00     3.00     1.00     1.00     1.00  ; ...
      33    42    2.00     2.00     3.00     1.00     1.30     1.00  ; ...
      34    47    2.00     2.00     3.00     1.00     1.00     2.00  ; ...
      35    55    3.05     2.00     2.00     1.00     0.50     2.00  ; ...
      36    63    3.00     3.00     3.00     0.50     0.30     1.00  ];
   
%   index lat     O3       N2O      CH4     CFC11    STEMP    C_L
   cov_carb2 = [
      1    -62    2.00     2.00     1.00     0.80     0.10     2.10  ; ...
      2    -53    2.00     2.00     1.00     1.10     0.10     2.10  ; ...
      3    -47    2.00     2.00     1.00     2.00     0.10     2.00  ; ...
      4    -42    2.00     2.00     1.00     1.10     0.10     2.10  ; ...
      5    -37    2.00     2.00     1.00     0.60     0.10     1.90  ; ...
      6    -32    2.00     2.00     1.00     0.55     0.10     2.00  ; ...
      7    -28    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      8    -26    2.00     2.00     1.00     0.55     0.10     2.10  ; ...
      9    -23    2.00     2.00     1.00     0.55     0.10     2.10  ; ...
      10   -21    2.00     2.00     1.00     0.55     0.10     2.10  ; ...
      11   -18    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      12   -16    2.00     2.00     1.00     0.65     0.10     2.10  ; ...
      13   -13    2.00     2.00     1.00     0.65     0.10     2.10  ; ...
      14   -11    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      15    -8    1.00     2.00     1.00     0.65     0.10     2.10  ; ...
      16    -6    2.00     2.00     1.00     0.75     0.10     2.10  ; ...
      17    -3    2.00     2.00     1.00     0.80     0.10     2.10  ; ...
      18    -1    2.00     2.00     1.00     0.85     0.10     2.10  ; ...
      19     1    2.00     2.00     1.00     1.00     0.10     2.10  ; ...
      20     3    2.00     2.00     1.00     0.90     0.10     2.10  ; ...
      21     6    2.00     2.00     1.00     0.70     0.10     0.20  ; ...
      22     8    2.00     2.00     1.00     0.65     0.10     2.10  ; ...
      23    11    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      24    13    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      25    16    2.00     2.00     1.00     0.60     0.10     2.20  ; ...
      26    18    2.00     2.00     1.00     0.55     0.10     2.10  ; ...
      27    21    2.00     2.00     1.00     0.55     0.10     2.10  ; ...
      28    23    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      29    26    2.00     2.00     1.00     0.60     0.10     2.10  ; ...
      30    28    1.00     2.00     1.00     0.65     0.10     2.10  ; ...
      31    32    1.00     1.00     1.00     0.50     0.10     2.10  ; ...
      32    37    1.00     1.00     2.00     0.70     0.10     2.20  ; ...
      33    42    1.00     1.00     1.00     0.90     0.10     2.20  ; ...
      34    47    1.00     1.00     1.00     1.10     0.10     2.20  ; ...
      35    55    1.00     1.00     1.00     1.10     0.10     2.20  ; ...
      36    63    1.00     2.00     1.00     1.50     0.10     2.10  ];

   cov_carb = [cov_carb1 cov_carb2(:,3:end)];
   clear cov_carb1 cov_carb2

% index lat TS TUT TLT WVS WVT CO2 O3 N2O CH4 CFC11 STEMP C_L
%   1    2   3  4   5   6   7   8   9  10  11   12    13   14
   TS    = cov_prof(:,3);
   TUT   = cov_prof(:,4);
   TLT   = cov_prof(:,5);
   WVS   = cov_prof(:,6);
   WVT   = cov_prof(:,7);
   CO2   = cov_prof(:,8);
   O3    = cov_prof(:,9); 
   N2O   = cov_prof(:,10);
   CH4   = cov_prof(:,11); 
   CFC11 = cov_prof(:,12); 
   STEMP = cov_prof(:,13); 
   C_L   = cov_prof(:,14);
end 
 
% strat temp
 driver.oem.sigma.temp_strat_VALUE  = TS(ix)*0.01;       %% sigsqr
 driver.oem.sigma.temp_strat_TOPLAY = 01;  %% start layer
 driver.oem.sigma.temp_strat_BOTLAY = 49;  %% stop layer
% upper trop temp 
 driver.oem.sigma.temp_upper_trop_VALUE = TUT(ix)*0.01; 
 driver.oem.sigma.temp_upper_trop_TOPLAY = 50;  %% start layer
 driver.oem.sigma.temp_upper_trop_BOTLAY = 79; 
% lower trop temp
 driver.oem.sigma.temp_trop_VALUE  = TLT(ix)*0.01;       %% sigsqr
 driver.oem.sigma.temp_trop_TOPLAY = 80;  %% start layer
 driver.oem.sigma.temp_trop_BOTLAY = 97;  %% stop layer
 driver.oem.sigma.temp_trop_TOPLAY = driver.oem.sigma.temp_upper_trop_BOTLAY + 1; %% start layer
 driver.oem.sigma.temp_trop_BOTLAY = driver.jacobian.numlays;                %% stop layer
% strat GAS 1
 driver.oem.sigma.hum_strat_VALUE  = WVS(ix)*0.01;       %% sigsqr
 driver.oem.sigma.hum_strat_TOPLAY = 01;  %% start layer
 driver.oem.sigma.hum_strat_BOTLAY = 49;  %% stop layer
% trop GAS 1
 driver.oem.sigma.hum_trop_VALUE  = WVT(ix)*0.01;       %% sigsqr
 driver.oem.sigma.hum_trop_TOPLAY = 50;  %% start layer
 driver.oem.sigma.hum_trop_BOTLAY = 97;  %% stop layer
 driver.oem.sigma.hum_trop_TOPLAY = driver.oem.sigma.hum_strat_BOTLAY + 1; %% start layer
 driver.oem.sigma.hum_trop_BOTLAY = driver.jacobian.numlays;                %% stop layer
% length_correlation for T(z) and WV(z) .. note this is in terms of INDEX
 driver.oem.sigma.l_c = C_L(ix);
% QST 1 ..6 values
 driver.oem.sigma.qst(1) = CO2(ix)*2.20;  %% co2
 driver.oem.sigma.qst(2) = O3(ix)*0.01;  %% o3
 driver.oem.sigma.qst(3) = N2O(ix)*1.00;  %% n2o
 driver.oem.sigma.qst(4) = CH4(ix)*5.00;  %% ch4 
 driver.oem.sigma.qst(5) = CFC11(ix)*1.00;  %% cfc11
 driver.oem.sigma.qst(6) = STEMP(ix)*0.10;  %% Stemp


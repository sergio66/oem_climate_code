for ii = 1 : length(latbins)-1
  indx = (yy-2003+1)*40 + ii;
  boo = find(poem.rlat >= latbins(ii) & poem.rlat < latbins(ii+1) & poemNew.QA >= 120);

  if length(boo) > 5
    pbefore.upwell(indx)  = 1;
    pbefore.year(indx)    = yy;
    pbefore.latbin(indx)  = ii;
    pbefore.zobs(indx)    = nanmean(poem.zobs(boo));
    pbefore.salti(indx)   = nanmean(poem.salti(boo));
    pbefore.landfrac(indx)= nanmean(poem.landfrac(boo));
    pbefore.satzen(indx)  = nanmean(poem.satzen(boo));
    pbefore.scanang(indx) = nanmean(poem.scanang(boo));
    pbefore.satzen(indx)  = nanmean(poem.satzen(boo));
    pbefore.nemis(indx)   = nanmean(poem.nemis(boo));
    pbefore.efreq(:,indx) = nanmean(poem.efreq(:,boo),2);
    pbefore.emis(:,indx)  = nanmean(poem.emis(:,boo),2);
    pbefore.rho(:,indx)   = nanmean(poem.rho(:,boo),2);
    pbefore.spres(indx)   = nanmean(poem.spres(boo));
    pbefore.rlon(indx)    = nanmean(poem.rlon(boo));
    pbefore.rlat(indx)    = nanmean(poem.rlat(boo));
    pbefore.rtime(indx)   = nanmean(poem.rtime(boo));
    pbefore.stemp(indx)   = nanmean(poem.stemp(boo));
    pbefore.colWV(indx)   = nanmean(colwater0(boo));
    pbefore.RH(:,indx)    = nanmean(RH0(:,boo),2);
    pbefore.ptemp(:,indx) = nanmean(poem.ptemp(:,boo),2);
    pbefore.plevs(:,indx) = nanmean(poem.plevs(:,boo),2);
    pbefore.palts(:,indx) = nanmean(poem.palts(:,boo),2);
    pbefore.gas_1(:,indx) = nanmean(poem.gas_1(:,boo),2);
    pbefore.gas_2(:,indx) = nanmean(poem.gas_2(:,boo),2);
    pbefore.gas_3(:,indx) = nanmean(poem.gas_3(:,boo),2);
    pbefore.gas_4(:,indx) = nanmean(poem.gas_4(:,boo),2);
    pbefore.gas_5(:,indx) = nanmean(poem.gas_5(:,boo),2);
    pbefore.gas_6(:,indx) = nanmean(poem.gas_6(:,boo),2);
    pbefore.std_stemp(indx)   = nanstd(poem.stemp(boo));
    pbefore.std_colWV(indx)   = nanstd(colwater0(boo));
    pbefore.std_RH(:,indx)    = nanstd(RH0(:,boo),0,2);
    pbefore.std_ptemp(:,indx) = nanstd(poem.ptemp(:,boo),0,2);
    pbefore.std_plevs(:,indx) = nanstd(poem.plevs(:,boo),0,2);
    pbefore.std_palts(:,indx) = nanstd(poem.palts(:,boo),0,2);
    pbefore.std_gas_1(:,indx) = nanstd(poem.gas_1(:,boo),0,2);
    pbefore.std_gas_2(:,indx) = nanstd(poem.gas_2(:,boo),0,2);
    pbefore.std_gas_3(:,indx) = nanstd(poem.gas_3(:,boo),0,2);
    pbefore.std_gas_4(:,indx) = nanstd(poem.gas_4(:,boo),0,2);
    pbefore.std_gas_5(:,indx) = nanstd(poem.gas_5(:,boo),0,2);
    pbefore.std_gas_6(:,indx) = nanstd(poem.gas_6(:,boo),0,2);

    pafter.upwell(indx)  = 1;
    pafter.year(indx)    = yy;
    pafter.latbin(indx)  = ii;
    pafter.zobs(indx)    = nanmean(poemNew.zobs(boo));
    pafter.salti(indx)   = nanmean(poemNew.salti(boo));
    pafter.landfrac(indx)= nanmean(poemNew.landfrac(boo));
    pafter.satzen(indx)  = nanmean(poemNew.satzen(boo));
    pafter.scanang(indx) = nanmean(poemNew.scanang(boo));
    pafter.satzen(indx)  = nanmean(poemNew.satzen(boo));
    pafter.nemis(indx)   = nanmean(poemNew.nemis(boo));
    pafter.efreq(:,indx) = nanmean(poemNew.efreq(:,boo),2);
    pafter.emis(:,indx)  = nanmean(poemNew.emis(:,boo),2);
    pafter.rho(:,indx)   = nanmean(poemNew.rho(:,boo),2);
    pafter.rlon(indx)    = nanmean(poemNew.rlon(boo));
    pafter.rlat(indx)    = nanmean(poemNew.rlat(boo));
    pafter.spres(indx)   = nanmean(poemNew.spres(boo));
    pafter.rtime(indx)   = nanmean(poemNew.rtime(boo));
    pafter.stemp(indx)   = nanmean(poemNew.stemp(boo));
    pafter.colWV(indx)   = nanmean(colwaterF(boo));
    pafter.RH(:,indx)    = nanmean(RHF(:,boo),2);
    pafter.plevs(:,indx) = nanmean(poemNew.plevs(:,boo),2);
    pafter.palts(:,indx) = nanmean(poemNew.palts(:,boo),2);
    pafter.ptemp(:,indx) = nanmean(poemNew.ptemp(:,boo),2);
    pafter.gas_1(:,indx) = nanmean(poemNew.gas_1(:,boo),2);
    pafter.gas_2(:,indx) = nanmean(poemNew.gas_2(:,boo),2);
    pafter.gas_3(:,indx) = nanmean(poemNew.gas_3(:,boo),2);
    pafter.gas_4(:,indx) = nanmean(poemNew.gas_4(:,boo),2);
    pafter.gas_5(:,indx) = nanmean(poemNew.gas_5(:,boo),2);
    pafter.gas_6(:,indx) = nanmean(poemNew.gas_6(:,boo),2);
    pafter.std_stemp(indx)   = nanstd(poemNew.stemp(boo));
    pafter.std_colWV(indx)   = nanstd(colwaterF(boo));
    pafter.std_RH(:,indx)    = nanstd(RHF(:,boo),0,2);
    pafter.std_plevs(:,indx) = nanstd(poemNew.plevs(:,boo),0,2);
    pafter.std_palts(:,indx) = nanstd(poemNew.palts(:,boo),0,2);
    pafter.std_ptemp(:,indx) = nanstd(poemNew.ptemp(:,boo),0,2);
    pafter.std_gas_1(:,indx) = nanstd(poemNew.gas_1(:,boo),0,2);
    pafter.std_gas_2(:,indx) = nanstd(poemNew.gas_2(:,boo),0,2);
    pafter.std_gas_3(:,indx) = nanstd(poemNew.gas_3(:,boo),0,2);
    pafter.std_gas_4(:,indx) = nanstd(poemNew.gas_4(:,boo),0,2);
    pafter.std_gas_5(:,indx) = nanstd(poemNew.gas_5(:,boo),0,2);
    pafter.std_gas_6(:,indx) = nanstd(poemNew.gas_6(:,boo),0,2);

    pafter.diff_mean_stemp(indx)   = nanmean(poemNew.stemp(boo)-poem.stemp(boo));
    pafter.diff_mean_colWV(indx)   = nanmean(colwaterF(boo)-colwater0(boo));
    pafter.diff_mean_RH(:,indx)    = nanmean(RHF(:,boo)-RH0(:,boo),2);
    pafter.diff_mean_plevs(:,indx) = nanmean(poemNew.plevs(:,boo)-poem.plevs(:,boo),2);
    pafter.diff_mean_palts(:,indx) = nanmean(poemNew.palts(:,boo)-poem.palts(:,boo),2);
    pafter.diff_mean_ptemp(:,indx) = nanmean(poemNew.ptemp(:,boo)-poem.ptemp(:,boo),2);
    pafter.diff_mean_gas_1(:,indx) = nanmean(poemNew.gas_1(:,boo)./poem.gas_1(:,boo),2);
    pafter.diff_mean_gas_2(:,indx) = nanmean(poemNew.gas_2(:,boo)./poem.gas_2(:,boo),2);
    pafter.diff_mean_gas_3(:,indx) = nanmean(poemNew.gas_3(:,boo)./poem.gas_3(:,boo),2);
    pafter.diff_mean_gas_4(:,indx) = nanmean(poemNew.gas_4(:,boo)./poem.gas_4(:,boo),2);
    pafter.diff_mean_gas_5(:,indx) = nanmean(poemNew.gas_5(:,boo)./poem.gas_5(:,boo),2);
    pafter.diff_mean_gas_6(:,indx) = nanmean(poemNew.gas_6(:,boo)./poem.gas_6(:,boo),2);
    pafter.diff_std_stemp(indx)   = nanstd(poemNew.stemp(boo)-poem.stemp(boo));
    pafter.diff_std_colWV(indx)   = nanstd(colwaterF(boo)-colwater0(boo));
    pafter.diff_std_RH(:,indx)    = nanstd(RHF(:,boo)-RH0(:,boo),0,2);
    pafter.diff_std_plevs(:,indx) = nanstd(poemNew.plevs(:,boo)-poem.plevs(:,boo),0,2);
    pafter.diff_std_palts(:,indx) = nanstd(poemNew.palts(:,boo)-poem.palts(:,boo),0,2);
    pafter.diff_std_ptemp(:,indx) = nanstd(poemNew.ptemp(:,boo)-poem.ptemp(:,boo),0,2);
    pafter.diff_std_gas_1(:,indx) = nanstd(poemNew.gas_1(:,boo)./poem.gas_1(:,boo),0,2);
    pafter.diff_std_gas_2(:,indx) = nanstd(poemNew.gas_2(:,boo)./poem.gas_2(:,boo),0,2);
    pafter.diff_std_gas_3(:,indx) = nanstd(poemNew.gas_3(:,boo)./poem.gas_3(:,boo),0,2);
    pafter.diff_std_gas_4(:,indx) = nanstd(poemNew.gas_4(:,boo)./poem.gas_4(:,boo),0,2);
    pafter.diff_std_gas_5(:,indx) = nanstd(poemNew.gas_5(:,boo)./poem.gas_5(:,boo),0,2);
    pafter.diff_std_gas_6(:,indx) = nanstd(poemNew.gas_6(:,boo)./poem.gas_6(:,boo),0,2);

  else
    pbefore.upwell(indx)  = 1;
    pbefore.year(indx)    = yy;
    pbefore.latbin(indx)  = ii;
    pbefore.zobs(indx)    = nan;
    pbefore.salti(indx)   = nan;
    pbefore.landfrac(indx)= nan;
    pbefore.satzen(indx)  = nan;
    pbefore.scanang(indx) = nan;
    pbefore.satzen(indx)  = nan;
    pbefore.nemis(indx)   = nan;
    pbefore.efreq(:,indx) = nan * ones(100,1);
    pbefore.emis(:,indx)  = nan * ones(100,1);
    pbefore.rho(:,indx)   = nan * ones(100,1);
    pbefore.rlon(indx)    = nan;
    pbefore.rlat(indx)    = nan;
    pbefore.spres(indx)   = nan;
    pbefore.rtime(indx)   = nan;
    pbefore.stemp(indx)   = nan;
    pbefore.colWV(indx)   = nan;
    pbefore.RH(:,indx)    = nan * ones(101,1);
    pbefore.plevs(:,indx) = nan * ones(101,1);
    pbefore.palts(:,indx) = nan * ones(101,1);
    pbefore.ptemp(:,indx) = nan * ones(101,1);
    pbefore.gas_1(:,indx) = nan * ones(101,1);
    pbefore.gas_2(:,indx) = nan * ones(101,1);
    pbefore.gas_3(:,indx) = nan * ones(101,1);
    pbefore.gas_4(:,indx) = nan * ones(101,1);
    pbefore.gas_5(:,indx) = nan * ones(101,1);
    pbefore.gas_6(:,indx) = nan * ones(101,1);
    pbefore.std_stemp(indx)   = nan;
    pbefore.std_colWV(indx)   = nan;
    pbefore.std_RH(:,indx)    = nan * ones(101,1);
    pbefore.std_plevs(:,indx) = nan * ones(101,1);
    pbefore.std_palts(:,indx) = nan * ones(101,1);
    pbefore.std_ptemp(:,indx) = nan * ones(101,1);
    pbefore.std_gas_1(:,indx) = nan * ones(101,1);
    pbefore.std_gas_2(:,indx) = nan * ones(101,1);
    pbefore.std_gas_3(:,indx) = nan * ones(101,1);
    pbefore.std_gas_4(:,indx) = nan * ones(101,1);
    pbefore.std_gas_5(:,indx) = nan * ones(101,1);
    pbefore.std_gas_6(:,indx) = nan * ones(101,1);

    pafter.upwell(indx)  = 1;
    pafter.year(indx)    = yy;
    pafter.latbin(indx)  = ii;
    pafter.zobs(indx)    = nan;
    pafter.salti(indx)   = nan;
    pafter.landfrac(indx)= nan;
    pafter.satzen(indx)  = nan;
    pafter.scanang(indx) = nan;
    pafter.satzen(indx)  = nan;
    pafter.nemis(indx)   = nan;
    pafter.efreq(:,indx) = nan * ones(100,1);
    pafter.emis(:,indx)  = nan * ones(100,1);
    pafter.rho(:,indx)   = nan * ones(100,1);
    pafter.rlon(indx)    = nan;
    pafter.rlat(indx)    = nan;
    pafter.spres(indx)   = nan;
    pafter.rtime(indx)   = nan;
    pafter.stemp(indx)   = nan;
    pafter.colWV(indx)   = nan;
    pafter.RH(:,indx)    = nan * ones(101,1);
    pafter.plevs(:,indx) = nan * ones(101,1);
    pafter.palts(:,indx) = nan * ones(101,1);
    pafter.ptemp(:,indx) = nan * ones(101,1);
    pafter.gas_1(:,indx) = nan * ones(101,1);
    pafter.gas_2(:,indx) = nan * ones(101,1);
    pafter.gas_3(:,indx) = nan * ones(101,1);
    pafter.gas_4(:,indx) = nan * ones(101,1);
    pafter.gas_5(:,indx) = nan * ones(101,1);
    pafter.gas_6(:,indx) = nan * ones(101,1);
    pafter.std_stemp(indx)   = nan;
    pafter.std_colWV(indx)   = nan;
    pafter.std_RH(:,indx)    = nan * ones(101,1);
    pafter.std_plevs(:,indx) = nan * ones(101,1);
    pafter.std_palts(:,indx) = nan * ones(101,1);
    pafter.std_ptemp(:,indx) = nan * ones(101,1);
    pafter.std_gas_1(:,indx) = nan * ones(101,1);
    pafter.std_gas_2(:,indx) = nan * ones(101,1);
    pafter.std_gas_3(:,indx) = nan * ones(101,1);
    pafter.std_gas_4(:,indx) = nan * ones(101,1);
    pafter.std_gas_5(:,indx) = nan * ones(101,1);
    pafter.std_gas_6(:,indx) = nan * ones(101,1);

    pafter.diff_mean_stemp(indx)   = nan;
    pafter.diff_mean_colWV(indx)   = nan;
    pafter.diff_mean_RH(:,indx)    = nan * ones(101,1);
    pafter.diff_mean_plevs(:,indx) = nan * ones(101,1);
    pafter.diff_mean_palts(:,indx) = nan * ones(101,1);
    pafter.diff_mean_ptemp(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_1(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_2(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_3(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_4(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_5(:,indx) = nan * ones(101,1);
    pafter.diff_mean_gas_6(:,indx) = nan * ones(101,1);

    pafter.diff_std_stemp(indx)   = nan;
    pafter.diff_std_colWV(indx)   = nan;
    pafter.diff_std_RH(:,indx)    = nan * ones(101,1);
    pafter.diff_std_plevs(:,indx) = nan * ones(101,1);
    pafter.diff_std_palts(:,indx) = nan * ones(101,1);
    pafter.diff_std_ptemp(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_1(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_2(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_3(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_4(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_5(:,indx) = nan * ones(101,1);
    pafter.diff_std_gas_6(:,indx) = nan * ones(101,1);

  end  
end
